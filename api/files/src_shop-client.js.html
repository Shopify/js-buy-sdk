---
layout: default
---


<script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>

<div id="doc">
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Config.html">Config</a></li>
                                <li><a href="../classes/ShopClient.html">ShopClient</a></li>
                                <li><a href="../classes/ShopifyBuy.html">ShopifyBuy</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/config.html">config</a></li>
                                <li><a href="../modules/js-buy-sdk.html">js-buy-sdk</a></li>
                                <li><a href="../modules/shop-client.html">shop-client</a></li>
                                <li><a href="../modules/shopify.html">shopify</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/shop-client.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import PublicationSerializer from &#x27;./serializers/publication-serializer&#x27;;
import PublicationAdapter from &#x27;./adapters/publication-adapter&#x27;;
import CheckoutSerializer from &#x27;./serializers/checkout-serializer&#x27;;
import CheckoutAdapter from &#x27;./adapters/checkout-adapter&#x27;;
import CoreObject from &#x27;./metal/core-object&#x27;;
import assign from &#x27;./metal/assign&#x27;;

/**
 * @module js-buy-sdk
 * @submodule shop-client
 */

function fetchFactory(fetchType, type) {
  let func;

  switch (fetchType) {
      case &#x27;all&#x27;:
        func = function () {
          return this.fetchAll(type);
        };
        break;
      case &#x27;one&#x27;:
        func = function () {
          return this.fetch(type, ...arguments);
        };
        break;
      case &#x27;query&#x27;:
        func = function () {
          return this.fetchQuery(type, ...arguments);
        };
        break;
  }

  return func;
}

const ShopClient = CoreObject.extend({
  /**
   * @class ShopClient
   * @constructor
   * @param {Config} [config] Config data to be used throughout all API
   * interaction
   */
  constructor(config) {
    this.config = config;

    this.serializers = {
      products: PublicationSerializer,
      collections: PublicationSerializer,
      checkouts: CheckoutSerializer
    };

    this.adapters = {
      products: PublicationAdapter,
      collections: PublicationAdapter,
      checkouts: CheckoutAdapter
    };
  },

  config: null,

  // Prevent leaky state
  get serializers() {
    return assign({}, this.shadowedSerializers);
  },

  set serializers(values) {
    this.shadowedSerializers = assign({}, values);
  },

  get adapters() {
    return assign({}, this.shadowedAdapters);
  },

  set adapters(values) {
    this.shadowedAdapters = assign({}, values);
  },

  /**
   * Fetch all of a &#x60;type&#x60;, returning a promise.
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetchAll(&#x27;products&#x27;).then(products =&gt; {
   *   // do things with products
   * });
   * &#x60;&#x60;&#x60;
   *
   * @method fetchAll
   * @public
   * @param {String} type The pluralized name of the type, in lower case.
   * @return {Promise|Array} a promise resolving with an array of &#x60;type&#x60;
   */
  fetchAll(type) {
    const adapter = new this.adapters[type](this.config);

    return adapter.fetchMultiple(type).then(payload =&gt; {
      return this.deserialize(type, payload, adapter, { multiple: true });
    });
  },

  /**
   * Fetch one of a &#x60;type&#x60;, returning a promise.
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetch(&#x27;products&#x27;, 123).then(product =&gt; {
   *   // do things with the product
   * });
   * &#x60;&#x60;&#x60;
   *
   * @method fetch
   * @public
   * @param {String} type The pluralized name of the type, in lower case.
   * @param {String|Number} id a unique identifier
   * @return {Promise|BaseModel} a promise resolving with a single instance of
   * &#x60;type&#x60; expressed as a &#x60;BaseModel&#x60;.
   */
  fetch(type, id) {
    const adapter = new this.adapters[type](this.config);

    return adapter.fetchSingle(type, id).then(payload =&gt; {
      return this.deserialize(type, payload, adapter, { single: true });
    });
  },

  /**
   * Fetch many of a &#x60;type&#x60;, that match &#x60;query&#x60;
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetchQuery(&#x27;products&#x27;, { collection_id: 456 }).then(products =&gt; {
   *   // do things with the products
   * });
   * &#x60;&#x60;&#x60;
   *
   * @method fetchQuery
   * @public
   * @param {String} type The pluralized name of the type, in lower case.
   * @param {Object} query a query sent to the api server.
   * @return {Promise|Array} a promise resolving with an array of &#x60;type&#x60;.
   */
  fetchQuery(type, query) {
    const adapter = new this.adapters[type](this.config);

    return adapter.fetchMultiple(type, query).then(payload =&gt; {
      return this.deserialize(type, payload, adapter, { multiple: true });
    });
  },

  /**
   * Create an instance of &#x60;type&#x60;, optionally including &#x60;attrs&#x60;.
   *
   * &#x60;&#x60;&#x60;javascript
   * client.create(&#x27;checkouts&#x27;, { line_items: [ ... ] }).then(checkout =&gt; {
   *   // do things with the checkout.
   * });
   * &#x60;&#x60;&#x60;
   *
   * @method create
   * @public
   * @param {String} type The pluralized name of the type, in lower case.
   * @param {Object} [attrs={}] attributes to send to the server for creation.
   * @return {Promise|CartModel} a promise resolving with a single instance of
   * &#x60;type&#x60;
   */
  create(type, attrs = {}) {
    const adapter = new this.adapters[type](this.config);

    return adapter.create(type, attrs).then(payload =&gt; {
      return this.deserialize(type, payload, adapter, { single: true });
    });
  },

  /**
   * Create an instance of &#x60;type&#x60;, optionally including &#x60;attrs&#x60;.
   *
   * &#x60;&#x60;&#x60;javascript
   * client.create(&#x27;checkouts&#x27;, { line_items: [ ... ] }).then(checkout =&gt; {
   *   // do things with the checkout.
   * });
   * &#x60;&#x60;&#x60;
   *
   * @method update
   * @public
   * @param {String} type The pluralized name of the type, in lower case.
   * @param {BaseModel} updatedModel The model that represents new state to
   * to persist to the server.
   * @return {Promise|CartModel} a promise resolving with a single instance of
   * &#x60;type&#x60;
   */
  update(type, updatedModel) {
    const adapter = updatedModel.adapter;
    const serializer = updatedModel.serializer;
    const serializedModel = serializer.serialize(type, updatedModel);
    const id = updatedModel.attrs[adapter.idKeyForType(type)];

    return adapter.update(type, id, serializedModel).then(payload =&gt; {
      const meta = { shopClient: this, adapter, serializer, type };

      return serializer.deserializeSingle(type, payload, meta);
    });
  },

  /**
   * Proxy to serializer&#x27;s deserialize.
   *
   * @method deserialize
   * @private
   * @param {String} type The pluralized name of the type, in lower case.
   * @param {Object} payload The raw payload returned by the adapter.
   * @param {BaseAdapter} adapter The adapter that yielded the payload.
   * @param {Object} opts Options that determine which deserialization method to
   * use.
   * @param {Boolean} opts.multiple true when the payload represents multiple
   * models
   * @param {Boolean} opts.single true when the payload represents one model.
   * @return {BaseModel} an instance of &#x60;type&#x60; reified into a model.
   */
  deserialize(type, payload, adapter, opts = {}) {
    const serializer = new this.serializers[type](this.config);
    const meta = { shopClient: this, adapter, serializer, type };
    let serializedPayload;

    if (opts.multiple) {
      serializedPayload = serializer.deserializeMultiple(type, payload, meta);
    } else {
      serializedPayload = serializer.deserializeSingle(type, payload, meta);
    }

    return serializedPayload;
  },

  /**
   * Convenience wrapper for {{#crossLink &quot;ShopClient/fetchAll:method&quot;}}
   * {{/crossLink}}. Equivalent to:
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetchAll(&#x27;products&#x27;);
   * &#x60;&#x60;&#x60;
   *
   * @method fetchAllProducts
   * @public
   * @return {Promise|Array} The product models.
   */
  fetchAllProducts: fetchFactory(&#x27;all&#x27;, &#x27;products&#x27;),

  /**
   * Convenience wrapper for {{#crossLink &quot;ShopClient/fetchAll:method&quot;}}
   * {{/crossLink}}. Equivalent to:
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetchAll(&#x27;collections&#x27;);
   * &#x60;&#x60;&#x60;
   *
   * @method fetchAllCollections
   * @public
   * @return {Promise|Array} The collection models.
   */
  fetchAllCollections: fetchFactory(&#x27;all&#x27;, &#x27;collections&#x27;),

  /**
   * Convenience wrapper for {{#crossLink &quot;ShopClient/fetch:method&quot;}}
   * {{/crossLink}}. Equivalent to:
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetch(&#x27;products&#x27;, 123);
   * &#x60;&#x60;&#x60;
   *
   * @method fetchProduct
   * @public
   * @param {String|Number} id a unique identifier
   * @return {Promise|BaseModel} The product model.
   */
  fetchProduct: fetchFactory(&#x27;one&#x27;, &#x27;products&#x27;),

  /**
   * Convenience wrapper for {{#crossLink &quot;ShopClient/fetch:method&quot;}}
   * {{/crossLink}}. Equivalent to:
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetch(&#x27;collections&#x27;, 123);
   * &#x60;&#x60;&#x60;
   *
   * @method fetchCollection
   * @public
   * @param {String|Number} id a unique identifier
   * @return {Promise|BaseModel} The collection model.
   */
  fetchCollection: fetchFactory(&#x27;one&#x27;, &#x27;collections&#x27;),

  /**
   * Convenience wrapper for {{#crossLink &quot;ShopClient/fetchQuery:method&quot;}}
   * {{/crossLink}}. Equivalent to:
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetchQuery(&#x27;products&#x27;, { query: &#x27;options&#x27; });
   * &#x60;&#x60;&#x60;
   *
   * @method fetchQueryProducts
   * @public
   * @param {Object} query a query sent to the api server.
   * @return {Promise|Array} The product models.
   */
  fetchQueryProducts: fetchFactory(&#x27;query&#x27;, &#x27;products&#x27;),

  /**
   * Convenience wrapper for {{#crossLink &quot;ShopClient/fetchQuery:method&quot;}}
   * {{/crossLink}}. Equivalent to:
   *
   * &#x60;&#x60;&#x60;javascript
   * client.fetchQuery(&#x27;collections&#x27;, { query: &#x27;options&#x27; });
   * &#x60;&#x60;&#x60;
   *
   * @method fetchQueryCollections
   * @public
   * @param {Object} query a query sent to the api server.
   * @return {Promise|Array} The collection models.
   */
  fetchQueryCollections: fetchFactory(&#x27;query&#x27;, &#x27;collections&#x27;)
});

export default ShopClient;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
